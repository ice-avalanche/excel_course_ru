# Урок 12. Элементы управления

**Элементы управления** – это интерактивные объекты, которые позволяют пользователю взаимодействовать с таблицей без прямого редактирования ячеек.  
Они делают отчеты и модели **удобными, визуальными и управляемыми**: можно нажать кнопку, выбрать значение из списка, установить флажок, ввести данные в поле и мгновенно получить результат.

Применяются для:
- создания **панелей управления и дашбордов**;
- автоматизации расчетов;
- формирования **мини-приложений** внутри Excel;
- визуализации сценариев и «что-если» анализа.

### Основные типы элементов

| Тип | Назначение | Пример |
|-----|-------------|--------|
| **Кнопка** | Запускает макрос или действие | «Обновить данные» |
| **Флажок (CheckBox)** | Включает/выключает параметр | Отображать диаграмму |
| **Переключатель (OptionButton)** | Выбор одного варианта | Режим расчета: «Базовый» / «Расширенный» |
| **Поле со списком (ComboBox)** | Выпадающий список | Выбор отдела |
| **Список (ListBox)** | Отображает набор значений | Список клиентов |
| **Поле со счетчиком (SpinButton)** | Пошаговое изменение числа | Количество месяцев прогноза |
| **Ползунок (ScrollBar)** | Гладкое изменение диапазона | Регулировка скидки |
| **Текстовое поле (TextBox)** | Ввод текста или числа | Имя пользователя, комментарий |

## 1. Вставка и настройка элементов управления

### Включение вкладки «Разработчик»

1. **Файл → Параметры → Настроить ленту**.  
2. В списке справа отметить флажок **«Разработчик»**.  
3. После этого на ленте появится вкладка с группой **Элементы управления**.

### Добавление элемента формы

1. **Разработчик → Вставить → Элементы формы.**  
2. Выбрать, например, **Флажок**.  
3. Нарисовать его на листе.  
4. Правый клик → **Формат объекта → Элемент управления**:
   - **Связанная ячейка:** адрес, куда будет записываться результат (`E1`);
   - При установке флажка значение = `ИСТИНА`, при снятии = `ЛОЖЬ`.

**Пример формулы:**

```excel
=ЕСЛИ(E1; "Показать"; "Скрыть")
````

### Добавление кнопки и макроса

1. **Разработчик → Вставить → Кнопка (форма)**.
2. Нарисовать кнопку → выбрать макрос → **Создать**.
3. В редакторе VBA:

```vba
Sub ClearData()
    Range("B2:B10").ClearContents
    MsgBox "Данные очищены!", vbInformation
End Sub
```

4. Вернуться в Excel, переименовать кнопку: **Очистить данные**.

## 2. Флажки и переключатели

### Флажки (CheckBox)

Используются для включения/отключения параметров.

| Пример            | Формула               |
| ----------------- | --------------------- |
| Применение скидки | `=ЕСЛИ(E1;A2*0,9;A2)` |

При установленном флажке (E1=ИСТИНА) применяется скидка 10%.

### Переключатели (OptionButton)

Позволяют выбрать **один из нескольких вариантов**.
Все переключатели группы связаны с одной ячейкой.

| Вариант     | Формула                                    |
| ----------- | ------------------------------------------ |
| 1 – Базовый | `=ЕСЛИ(F1=1;A2;ЕСЛИ(F1=2;A2*1,1;A2*1,25))` |

## 3. Списки и поля со списком

### Список (ListBox)

1. Создать диапазон `A1:A4` = Отделы.
2. Вставить **Список (форма)** → ПКМ → **Формат объекта**.
3. Задать:

   * **Диапазон ввода:** `A1:A4`;
   * **Связанная ячейка:** `E1`.

Формула для вывода выбранного значения:

```excel
=ИНДЕКС(A1:A4;E1)
```

### Поле со списком (ComboBox)

Похожий принцип, но список раскрывается вниз.

**Пример:** выбор региона

| Настройка        | Значение |
| ---------------- | -------- |
| Диапазон ввода   | `A1:A5`  |
| Связанная ячейка | `E1`     |

Формула:

```excel
=ИНДЕКС(A1:A5;E1)
```

## 4. Поле со счетчиком и ползунок

### Поле со счетчиком (SpinButton)

Позволяет изменять числовое значение по шагам.

| Параметр         | Пример |
| ---------------- | ------ |
| Минимум          | 0      |
| Максимум         | 30     |
| Шаг              | 1      |
| Связанная ячейка | `E1`   |

Формула:

```excel
=1000*(1-E1/100)
```

### Ползунок (ScrollBar)

Используется для визуального изменения диапазона.

**Пример:** управление бюджетом

| Минимум | Максимум | Шаг | Ячейка |
| ------- | -------- | --- | ------ |
| 1000    | 10000    | 500 | `E2`   |

Формула:

```excel
=E2*0,2
```

При перемещении ползунка результат пересчитывается автоматически.

## 5. Текстовые поля (TextBox)

Позволяют вводить текст и числа.

### Связь с ячейкой

1. Вставить **TextBox (ActiveX)**.
2. Свойство `LinkedCell = "B1"`.
3. В ячейке `C1` формула:

```excel
="Здравствуйте, " & B1 & "!"
```

Теперь при вводе имени в поле в C1 появится приветствие.

### Пример с VBA

```vba
Private Sub TextBox1_Change()
    Range("B1").Value = TextBox1.Text
End Sub
```

Любой ввод сразу записывается в ячейку `B1`.

## 6. Комбинирование элементов в интерфейсе

### Пример: мини-приложение «Расчет скидки»

| Элемент   | Назначение            |
| --------- | --------------------- |
| ComboBox  | Выбор товара          |
| ScrollBar | Изменение скидки      |
| TextBox   | Вывод итоговой цены   |
| Кнопка    | Обновление результата |

**Формула:**

```excel
=ИНДЕКС(B2:B5;E1)*(1-E2/100)
```

**Макрос:**

```vba
Sub RefreshPrice()
    Range("E3").Calculate
    MsgBox "Цена обновлена!", vbInformation
End Sub
```

Такое сочетание элементов превращает лист в удобный калькулятор.

## 7. Работа с ActiveX и VBA

ActiveX-элементы позволяют управлять логикой через код VBA.

| Элемент           | Событие           | Пример                      |
| ----------------- | ----------------- | --------------------------- |
| **CommandButton** | `Click`           | Запуск макроса              |
| **TextBox**       | `Change`          | Передача текста в ячейку    |
| **ComboBox**      | `DropButtonClick` | Динамическое заполнение     |
| **CheckBox**      | `Click`           | Показать / скрыть диаграмму |
| **ScrollBar**     | `Change`          | Пересчет формулы            |

**Пример:**

```vba
Private Sub ComboBox1_Change()
    Range("B1").Value = "Вы выбрали: " & ComboBox1.Value
End Sub
```

## 8. Советы по оформлению

| Совет            | Рекомендация                                                            |
| ---------------- | ----------------------------------------------------------------------- |
| **Группировка**  | Разделять элементы по смыслу: «Параметры», «Результаты», «Управление».  |
| **Подписи**      | Добавлять Label с пояснениями рядом с элементами.                       |
| **Выравнивание** | Использовать выравнивание и одинаковые размеры.                         |
| **Цвета**        | Использовать 2–3 основных цвета интерфейса.                             |
| **Фон**          | Светлый фон, читаемые шрифты (Calibri 11–12).                           |
| **Навигация**    | Кнопки «Назад» и «Далее» упрощают переходы между листами.               |
| **Тестирование** | Проверять работу всех элементов после сохранения файла.                 |
