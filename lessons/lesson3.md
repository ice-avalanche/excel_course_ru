# Урок 3. Обработка и анализ данных

## 1. Текст по столбцам

**Назначение:** преобразование объединённых данных (например, ФИО, адрес, «код;наименование») в отдельные поля.

**Алгоритм выполнения:**
1. Выделить столбец с исходными значениями → **Данные → Текст по столбцам**.
2. Выбрать метод: **С разделителями** или **С фиксированной шириной**.
3. Задать параметры разбиения.
4. Определить формат создаваемых столбцов (рекомендуется **Текст** для кодов/идентификаторов).

**Варианты разделителей (режим «С разделителями»):**
- Пробел  
- Запятая `,`  
- Точка с запятой `;`  
- Табуляция  
- Вертикальная черта `|` (как «Другой»)  
- Любой пользовательский символ (поле **Другой**)  
- Последовательность нескольких разделителей (включить **Считается подряд идущие разделители одним**)

**Особенности применения:**
- Неразрывные пробелы и невидимые символы рекомендуется предварительно заменить (поиск/замена) либо обработать в Power Query.
- Для кодов, артикулов, телефонов и т. п. указывать формат **Текст**, чтобы исключить потерю ведущих нулей и изменение формата.

## 2. Мгновенное заполнение

**Назначение:** автоматическая генерация значений по распознанному шаблону.

**Примеры применения:** сокращение ФИО («Иванов И.И.»), извлечение чисел из строк, преобразование «20250131» в «31.01.2025».

**Особенности применения:**
- Результат статичен; при изменении исходных данных требуется повторное применение.
- Для воспроизводимости и пересчёта предпочтительны формулы или Power Query.

## 3. Удаление дубликатов

**Назначение:** исключение повторяющихся записей по выбранным полям.

**Алгоритм выполнения:**
1. Выделить таблицу → **Данные → Удалить дубликаты**.
2. Отметить столбцы для сравнения → Подтвердить.

**Особенности применения:**
- Сравнение текстов нечувствительно к регистру.
- Для задач «оставить первую/последнюю запись по дате» применять сортировку + удаление дубликатов или Power Query.

## 4. Проверка данных

**Назначение:** ограничение допустимых значений ввода и сопровождение пользователя сообщениями.

**Типы проверок и условия:**
- **Целое число** — *между / не между / равно / не равно / больше / больше или равно / меньше / меньше или равно*.
- **Десятичное число** — те же сравнения, что и для целого.
- **Список** — значения через `;`, диапазон, именованный диапазон или столбец «умной таблицы». Опция **Списки со стрелкой** (выпадающее меню).
- **Дата** — сравнения аналогичны числам (включая относительные формулы, например `> СЕГОДНЯ()`).
- **Время** — сравнения аналогичны числам.
- **Длина текста** — сравнения по количеству символов.
- **Произвольное** — пользовательская формула, дающая ИСТИНА/ЛОЖЬ (например, `=ЕЧИСЛО(C2)`, `=И(C2>D2;E2<100)`).

**Параметры и сообщения:**
- **Игнорировать пустые** — разрешает пустой ввод.
- **В ячейке список** — включает выпадающее меню для типа «Список».
- **Подсказка при вводе** — информирует о правилах до ввода.
- **Сообщение об ошибке**:  
  - **Стоп** — блокирует неверный ввод.  
  - **Предупреждение** — допускает ввод, но с предупреждением.  
  - **Сведения** — информирует, не блокируя.

## 5. Консолидация

**Назначение:** агрегирование данных из нескольких диапазонов в сводную таблицу.

**Требования к исходным таблицам:**
- Одинаковая структура заголовков и расположение полей (для **консолидации по меткам** — идентичные названия; для **консолидации по позициям** — идентичные позиции столбцов/строк).
- Отсутствие «слитых» ячеек в области данных.
- Чёткие заголовки верхней строки и левого столбца при консолидации по меткам.

**Алгоритм выполнения:**
1. **Данные → Консолидация**.
2. Выбрать функцию (Сумма, Среднее, Максимум и т. д.).
3. Добавить диапазоны (в т. ч. с разных листов/книг).
4. Отметить **Подписи в верхней строке** и/или **в левом столбце** (для меток).
5. При необходимости включить **Создать связи с исходными данными** (динамическая разборка по ссылкам).

**Примечание:** при регулярном обновлении данных целесообразно использовать Power Query.

## 6. Группировка и Промежуточные итоги

**Назначение:** структурирование и суммирование в длинных списках.

**Предварительные условия:**
- Для **Промежуточных итогов** список должен быть **отсортирован по ключевому полю**, по которому выполняется суммирование.
- Не использовать «умную таблицу» (Ctrl+T); при необходимости преобразовать в обычный диапазон.

**Порядок действий:**
- **Группировка:** выделить строки/столбцы → **Данные → Группировать**. Настройки структуры: **Сводка ниже/выше**; уровни структуры слева.
- **Промежуточные итоги:** **Данные → Промежуточные итоги** → «При каждом изменении в» (ключ) → «Использовать функцию» (Сумма, Кол-во, Среднее и т. д.) → «Добавить итоги по» (список полей). При необходимости — «Заменить текущие итоги», «Итоги под данными».

## 7. Инструменты анализа «что-если»

### 7.1 Диспетчер сценариев

**Назначение:** хранение и переключение альтернативных наборов входных значений.

**Порядок работы:**
1. **Данные → Анализ «что-если» → Диспетчер сценариев** → **Добавить**.
2. Задать **Имя сценария**, выбрать **Изменяемые ячейки** (до 32 ячеек).
3. Указать значения для выбранных ячеек → **ОК**.
4. Для сравнения вариантов: **Сводка** → тип отчёта (**Отчёт по сценариям** или **Сводная диаграмма сценариев**) → выбрать «результирующие ячейки».

**Результат:** формируется лист с таблицей сценариев и итоговыми метриками; сценарии можно **Показать** для записи значений на лист.

**Особенности:**
- Сценарии сохраняют только значения изменяемых ячеек; формулы в результирующих ячейках пересчитываются.
- Доступны параметры защиты сценариев (изменение/скрытие).

### 7.2 Подбор параметра

**Назначение:** найти значение входной ячейки, при котором целевая формула принимает заданное значение.

**Порядок работы:**
1. **Данные → Анализ «что-если» → Подбор параметра**.
2. **Установить в ячейке** — ссылка на ячейку с формулой.
3. **Значение** — требуемый результат (число).
4. **Подбирая значение ячейки** — входной параметр, на который ссылается формула.
5. Выполнить поиск. При успешном завершении подтвердить **ОК** (записать найденное значение) или **Отмена** (сохранить исходное значение).

**Настройка итераций (обязательно при включённых итерационных расчётах):**  
**Файл → Параметры → Формулы → Параметры вычислений → Включить итерационный расчёт**.  
- **Максимальное число итераций** — ограничение числа шагов.  
- **Максимальное изменение** — требуемая точность решения.

**Интерпретация результата:**
- Если найдено решение — статус будет успешным, найденное значение записывается в изменяемую ячейку.
- Если решение не найдено — проверить монотонность функции на интервале, начальное приближение и корректность ссылок.

**Ограничения:** один изменяемый параметр; невозможность явного задания ограничений и целочисленности (для этого использовать «Поиск решения»).

### 7.3 Поиск решения

**Назначение:** оптимизация целевой функции с учётом нескольких переменных и ограничений.

**Подготовка:**
- Включить надстройку: **Файл → Параметры → Надстройки → Управление: Надстройки Excel → Перейти → Поиск решения**.
- Открыть: **Данные → Анализ → Поиск решения**.

**Настройка задачи:**
1. **Целевая функция** (ячейка с формулой) — варианты: **Максимум**, **Минимум**, **Заданное значение**.
2. **Изменяемые ячейки** — переменные оптимизации (одна или несколько).
3. **Ограничения** — добавить условия (неравенства, равенства, границы; целочисленность/биннарность; неотрицательность).
4. **Метод решения**:
   - **Simplex LP** — линейная оптимизация.
   - **GRG Nonlinear** — гладкие нелинейные модели.
   - **Evolutionary** — негладкие/дискретные задачи.
5. **Параметры…** — точность, допуски, максимальное время/итерации, начальные значения, допущение линейности/неотрицательности.

**Выполнение и интерпретация:**
- После расчёта отображается диалог со статусом (найдено оптимальное решение, достигнут предел итераций, нет допустимого решения).
- Отчёты (для линейных моделей): **Ответ**, **Пределы**, **Чувствительность** (анализ теневых цен, допусков по ограничениям).
- Кнопка **Сохранить модель** позволяет сохранить/загрузить параметры задачи на лист.

### 7.4 Таблицы данных

**Назначение:** массовая оценка влияния 1–2 параметров на результат.

**Подготовка и организация диапазона:**
- Ячейка **с формулой результата** размещается в левом верхнем углу таблицы (ячейка-угол).
- **Однопараметрическая таблица:** столбец значений входа — **под** формулой (или строка — **справа** от формулы).  
  Затем **Данные → Анализ «что-если» → Таблица данных** → указать **Подставлять по столбцу** (или **по строке**) — ссылку на *управляющую ячейку*.
- **Двухпараметрическая таблица:** список значений первого параметра размещается **в строке справа** от ячейки-угла, второго — **в столбце снизу**.  
  При вызове «Таблица данных» указать обе управляющие ячейки (**по строке** и **по столбцу**).

**Требования:**
- Формула результата должна ссылаться на управляющие ячейки, а не содержать числовые значения напрямую.
- Таблица данных должна быть обычным диапазоном (не «умной таблицей»).
- Для повышения производительности возможно использовать режим пересчёта **Автоматически, кроме таблиц данных**.

## 8. Лист прогноза

**Назначение:** формирование прогнозного ряда по датам на отдельном листе.

**Диалог «Лист прогноза»:**
- **Тип визуализации:** Линия/Столбчатая.
- **Окончание прогноза:** дата, до которой строится прогноз.
- **Варианты прогноза:** переключение на вкладку **Параметры**:
  - **Уверенность (%)** — уровень доверительного интервала (по умолчанию 95%).
  - **Сезонность:** автоопределение или ручной ввод периода сезонности.
  - **Диапазон временной шкалы** и **Диапазон значений** — исходные серии (можно скорректировать).
  - **Заполнение пропусков:** интерполяция или вставка нулей.
  - **Агрегация дубликатов дат:** Среднее/Сумма/Мин/Макс/Количество.
  - **Включить прогнозируемую статистику:** добавляет параметры модели на лист.

**Интерпретация:**
- Основная линия — оценка будущих значений.
- Заштрихованная область — доверительный интервал; его ширина растёт по мере увеличения горизонта.
- Рекомендуется наличие достаточного числа сезонных циклов (минимум 2–3) и стабильной частоты наблюдений.

## 9. Корреляция и регрессия

### Корреляция
**Цель:** измерить силу и направление линейной связи между двумя переменными.  
**Инструмент:** `=КОРРЕЛ(массив1;массив2)` или надстройка **Анализ данных → Корреляция**.

**Интерпретация коэффициента корреляции (r):**
- `|r| ≥ 0,7` — сильная связь; `0,3 ≤ |r| < 0,7` — умеренная; `|r| < 0,3` — слабая/отсутствует.
- Знак `r` указывает направление (прямая/обратная).
- Корреляция не доказывает причинно-следственную связь; чувствительна к выбросам.

### Регрессия (надстройка «Анализ данных → Регрессия»)

**Подготовка:**
- Включить **Пакет анализа**: **Файл → Параметры → Надстройки → Управление: Надстройки Excel → Перейти → Пакет анализа**.

**Параметры диалога:**
- **Входной интервал Y** — зависимая переменная.
- **Входной интервал X** — одна или несколько независимых (столбцы).
- **Метки** — если первая строка содержит заголовки.
- **Уровень доверия** — например, 95%.
- **Константа равна нулю** — форсирует нулевой свободный член.
- **Остатки / Стандартизованные остатки / Графики остатков** — диагностика модели.
- **Вывод** — в диапазон/на лист/в новую книгу.

**Результаты и интерпретация:**
- **Сводка по регрессии:**  
  - **Multiple R** — корреляция между фактическими и предсказанными значениями.  
  - **R Square (R²)** — доля дисперсии Y, объясняемая моделью.  
  - **Adjusted R Square** — скорректированный R² с учётом числа предикторов.  
  - **Standard Error** — средняя ошибка аппроксимации.  
  - **Observations** — объём выборки.
- **ANOVA (дисперсионный анализ):**  
  - **df, SS, MS, F, Significance F** — значимость модели в целом (малое **Significance F** свидетельствует о статистической значимости).
- **Коэффициенты:**  
  - **Intercept** (свободный член) и коэффициенты при X-переменных.  
  - **Std Error, t-Stat, P-value, Lower/Upper 95%** — проверка значимости отдельных предикторов (как правило, `P < 0,05` ⇒ значим).  
  - Знак коэффициента определяет направление влияния, величина — масштаб эффекта (при условии сопоставимости шкал).

**Замечания:**
- Проверять линейность связи, наличие выбросов, мультиколлинеарность (косвенно — по нестабильности знаков/значений, высокому стандартному отклонению коэффициентов).
- Для категориальных X-переменных использовать фиктивные (dummy) переменные.

## 10. Введение в Модель данных

**Назначение:** построение связанной модели из нескольких таблиц (схема «звезда»: таблица фактов + таблицы измерений) и создание сводных отчётов без ВПР.

**Подготовка исходных данных:**
- Преобразовать диапазоны в **умные таблицы** (Ctrl+T), задать осмысленные имена (например, `ФакПродажи`, `Календарь`, `СправочникКлиентов`).
- Обеспечить наличие ключей: уникальные идентификаторы в таблицах измерений и соответствующие внешние ключи в таблице фактов.
- Типы столбцов (число/дата/текст) должны быть корректными и согласованными.

**Способы добавления в Модель данных:**
1. **Power Query:** загрузка из источников → **Закрыть и загрузить в… → Только создать подключение** + **Добавить эти данные в модель данных**.
2. **Power Pivot:** вкладка **Power Pivot → Добавить в модель данных** (или **Управление** для открытия окна модели).
3. **Вставка сводной таблицы:** флажок **Добавить эти данные в модель данных**.

**Создание связей:**
- **Данные → Связи → Создать**: указать таблицы, поля (ключ ↔ внешний ключ), кардинальность (как правило, «один-ко-многим»).
- Проверить направление фильтрации (из измерений в факты) и корректность дат для календарных таблиц.

**Использование:**
- Построение сводных таблиц/диаграмм с полями из разных таблиц.
- Создание мер и вычисляемых столбцов на языке **DAX** (например, меры суммы/среднего, вычисление YTD/MTD с календарём).
